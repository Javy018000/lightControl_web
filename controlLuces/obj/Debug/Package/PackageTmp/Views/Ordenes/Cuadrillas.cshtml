@model List<controlLuces.Models.CuadrillaModel>
@using controlLuces.Models
@{
    ViewBag.Title = "Cuadrillas";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var usuario = Session["Usuario"] as UsuarioModel;
    var munSesion = (Session["Municipio"] as string) ?? usuario?.Municipio;
    var muniSel = ViewBag.MunicipioSeleccionado as string;
    var q = ViewBag.Query as string;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Cuadrillas - Light Control</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #f4f8fb;
            padding: 20px;
        }

        .main-header {
            background: linear-gradient(135deg,#0ea5e9,#3b82f6);
            color: #fff;
            border-radius: 14px;
            padding: 18px 25px;
            box-shadow: 0 10px 24px rgba(2,8,23,.12);
            font-size: 28px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: .6px;
        }

        .control-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

            .control-bar input, .control-bar select {
                padding: 12px 14px;
                border-radius: 12px;
                border: 1px solid #dbe6f5;
                background: #fff;
                box-shadow: 0 2px 6px rgba(2,8,23,.05) inset;
                transition: .2s;
            }

                .control-bar input:focus, .control-bar select:focus {
                    outline: none;
                    border-color: #3b82f6;
                    box-shadow: 0 0 0 3px rgba(59,130,246,.15);
                }

            .control-bar input {
                width: min(420px,85vw);
            }

            .control-bar button {
                background: linear-gradient(135deg,#3b82f6,#0ea5e9);
                border: none;
                color: #fff;
                font-weight: 700;
                padding: 12px 20px;
                border-radius: 12px;
                cursor: pointer;
                transition: .15s;
                box-shadow: 0 10px 18px rgba(59,130,246,.22);
            }

                .control-bar button:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 14px 22px rgba(59,130,246,.28);
                }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
            gap: 18px;
        }

        .card-c {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 8px 22px rgba(2,8,23,.08);
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

            .card-c .head {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 10px;
            }

        .badge-muni {
            background: #f3f7fc;
            color: #1f2937;
            border: 1px solid #e6edf5;
            border-radius: 999px;
            padding: 4px 10px;
            font-weight: 600;
        }

        .count {
            font-weight: 800;
            color: #0f172a;
        }

        .foot {
            display: flex;
            gap: 8px;
        }

        .btn-info {
            background: linear-gradient(135deg,#3b82f6,#0ea5e9) !important;
            border: none !important;
            color: #fff !important;
            font-weight: 700;
            border-radius: 10px;
            padding: 8px 14px;
            box-shadow: 0 8px 18px rgba(59,130,246,.25);
        }

        .btn-ghost {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 8px 14px;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="main-header">
        <i class="fa-solid fa-people-group"></i> CUADRILLAS
    </div>

    <form method="get" class="control-bar" action="@Url.Action("ListarCuadrillas","Ordenes")">
        @* Admin puede cambiar municipio; Admin_Local queda fijado por el controlador *@
        <select name="mun" class="form-select" style="width:220px">
            <option value="">(Todos)</option>
            @if (!string.IsNullOrWhiteSpace(munSesion))
            {
                <option value="@munSesion" @(muniSel == munSesion ? "selected" : "")>@munSesion</option>
            }
            @* Deja libre por si el Admin escribe otro municipio manualmente (servidor lo aceptará) *@
        </select>

        <input type="text" name="q" value="@(q ?? "")" placeholder="Buscar por nombre o clave..." />
        <button type="submit"><i class="fa-solid fa-magnifying-glass"></i> Buscar</button>

        <a class="btn btn-info" href="@Url.Action("crearCuadrilla","Ordenes")">
            <i class="fa-solid fa-plus"></i> Nueva cuadrilla
        </a>
    </form>

    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-info text-center">No hay cuadrillas para mostrar.</div>
    }
    else
    {
        <div class="grid">
            @foreach (var c in Model)
            {
                <div class="card-c">
                    <div class="head">
                        <h5 class="m-0"><i class="fa-solid fa-user-helmet-safety"></i> @c.Nombre</h5>
                        <span class="badge-muni"><i class="fa-solid fa-city"></i> @c.Municipio</span>
                    </div>
                    <div>
                        <div><strong>Clave:</strong> @c.Clave</div>
                        <div><strong>Órdenes asociadas:</strong> <span class="count">@c.OrdenesAsociadas</span></div>
                    </div>
                    <div class="foot">
                        @* Si más adelante quieres filtrar el historial por cuadrilla, aquí puedes enlazar *@
                        <a class="btn btn-info" href="@Url.Action("monitorear","Ordenes")">
                            <i class="fa-solid fa-list"></i> Ver historial
                        </a>
                        <a class="btn-ghost" href="@Url.Action("verOrdenes","Ordenes")">
                            <i class="fa-regular fa-rectangle-list"></i> Ver órdenes
                        </a>
                    </div>
                </div>
            }
        </div>
    }
</body>
</html>
