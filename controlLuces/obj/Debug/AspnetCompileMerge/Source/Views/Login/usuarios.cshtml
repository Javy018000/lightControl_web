@model List<controlLuces.Models.UsuarioModel>
@using controlLuces.Models
@using System.Linq
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var usuarioSesion = Session["Usuario"] as UsuarioModel;
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Usuarios - Light Control</title>

    <!-- Bootstrap y fuentes -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Product+Sans&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        body {
            font-family: 'Product Sans', 'Segoe UI', sans-serif;
            background-color: #f4f8fb;
            padding: 20px;
        }

        /* --- HEADER --- */
        .main-header {
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            color: #fff;
            border-radius: 14px;
            padding: 18px 25px;
            box-shadow: 0 10px 24px rgba(2, 8, 23, 0.12);
            font-size: 28px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: .6px;
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 25px;
        }

        /* --- TARJETA DE USUARIO --- */
        .user-card {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 8px 22px rgba(2, 8, 23, 0.08);
            padding: 18px 20px;
            transition: transform .2s ease, box-shadow .2s ease;
        }

            .user-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 12px 28px rgba(2, 8, 23, 0.12);
            }

        .user-header {
            background: linear-gradient(135deg, #3b82f6, #0ea5e9);
            color: #fff;
            padding: 12px 16px;
            border-radius: 10px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 14px;
            font-size: 18px;
        }

        .user-body p {
            margin: 4px 0;
            font-size: 15px;
            color: #334155;
        }

        .user-body strong {
            color: #0f172a;
        }

        .user-footer {
            text-align: center;
            margin-top: 10px;
        }

        /* --- BOTONES --- */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #0ea5e9);
            border: none;
            color: #fff;
            font-weight: 700;
            border-radius: 10px;
            padding: 8px 14px;
            margin: 3px;
            box-shadow: 0 8px 18px rgba(59,130,246,.25);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
            color: #fff;
            font-weight: 700;
            border-radius: 10px;
            padding: 8px 14px;
            margin: 3px;
            box-shadow: 0 8px 18px rgba(239,68,68,.25);
        }

        .btn-success {
            padding: 8px 24px;
            border-radius: 999px;
            font-weight: 600;
            border: none;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 10px 22px rgba(34,197,94,.34);
            transition: filter 0.15s, transform 0.15s;
        }

        .btn-success:hover {
            filter: brightness(1.05);
            transform: translateY(-1px);
            color: #fff;
        }

        .back-btn {
            padding: 8px 24px;
            border-radius: 999px;
            font-weight: 600;
            border: none;
            background: linear-gradient(135deg, #fb7185, #ef4444);
            color: #fff;
            text-decoration: none;
            margin-left: 10px;
            box-shadow: 0 10px 22px rgba(248,113,113,.34);
            transition: filter 0.15s, transform 0.15s;
        }

        .back-btn:hover {
            filter: brightness(1.05);
            transform: translateY(-1px);
            color: #fff;
        }

        .buttons-container {
            text-align: center;
            margin-top: 30px;
        }
    </style>
</head>

<body>
    <div class="container-fluid">

        <div class="main-header">
            <i class="fas fa-users"></i> Usuarios del Sistema
        </div>

        <div class="users-grid">
            @if (Model != null && Model.Any())
            {
                foreach (var usuario in Model)
                {
                    <div class="user-card">
                        <div class="user-header">
                            <i class="fas fa-user-circle"></i> Rol: @usuario.IdRol
                        </div>

                        <div class="user-body">
                            <p><strong>Identificación:</strong> @usuario.IdUsuario</p>
                            <p><strong>Nombre:</strong> @usuario.Nombre</p>
                            <p><strong>Apellido:</strong> @usuario.Apellido</p>
                            <p><strong>Correo:</strong> @usuario.Correo</p>
                            <p><strong>Rol:</strong> @usuario.IdRol</p>
                            <p><strong>Clave:</strong> @usuario.Clave</p>
                            <p><strong>Municipio:</strong> @(string.IsNullOrWhiteSpace(usuario.Municipio) ? "—" : usuario.Municipio)</p>

                            @if (usuario.IdRol == Rol.Tecnico)
                            {
                                <p><strong>Cuadrilla:</strong> @(string.IsNullOrWhiteSpace(usuario.Cuadrilla) ? "—" : usuario.Cuadrilla)</p>
                            }
                        </div>

                        <div class="user-footer">
                            <a href="javascript:void(0);"
                               onclick="confirmEdit('@Url.Action("EditarUsuarios", "Login", new { id = usuario.IdUsuario })')"
                               class="btn btn-primary btn-sm">
                                <i class="fas fa-user-edit"></i> Editar
                            </a>

                            @if (usuarioSesion != null && usuarioSesion.IdRol != Rol.Administrador_Local)
                            {
                                <a href="javascript:void(0);"
                                   onclick="confirmDelete('@Url.Action("EliminarUsuario", "Login", new { id = usuario.IdUsuario })')"
                                   class="btn btn-danger btn-sm">
                                    <i class="fas fa-trash-alt"></i> Eliminar
                                </a>
                            }
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="alert alert-info" role="alert">
                    <i class="fas fa-info-circle"></i> No hay usuarios registrados en el sistema.
                </div>
            }
        </div>

        <div class="buttons-container">
            <button onclick="window.location.href='@Url.Action("Registro", "Login")'" class="btn btn-success">
                <i class="fas fa-user-plus"></i> Crear Nuevo Usuario
            </button>

            <a href="@Url.Action("inicio", "Login")" class="back-btn">
                <i class="fas fa-arrow-left"></i> Atrás
            </a>
        </div>

    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        function confirmDelete(deleteUrl) {
            Swal.fire({
                title: '¿Está seguro?',
                text: "¡No podrás revertir esto!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, eliminarlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = deleteUrl;
                }
            });
        }

        function confirmEdit(editUrl) {
            Swal.fire({
                title: '¿Desea editar este usuario?',
                text: "¡Asegúrese de que desea realizar cambios!",
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, editar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = editUrl;
                }
            });
        }
    </script>

</body>
</html>