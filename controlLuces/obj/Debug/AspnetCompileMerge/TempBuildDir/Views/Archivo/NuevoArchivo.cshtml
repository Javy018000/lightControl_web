@{
    ViewBag.Title = "Cargar archivo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

<style>
    :root {
        --c1: #0ea5e9;
        --c2: #0369a1;
        --c3: #0b1120;
        --c4: #e0f2fe;
        --danger: #ef4444;
    }

    .page-wrapper-archivos {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px 16px 40px;
        background: radial-gradient(circle at top left, var(--c4) 0, var(--c1) 45%, var(--c2) 100%);
        border-radius: 24px;
        box-shadow: 0 20px 40px rgba(15, 23, 42, 0.35);
    }

    .main-header-archivos {
        background: linear-gradient(120deg, var(--c1), var(--c2));
        border-radius: 24px;
        padding: 18px 22px;
        color: #f9fafb;
    }

    .main-title-archivos {
        font-size: 1.35rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .main-subtitle-archivos {
        font-size: 0.8rem;
        opacity: 0.9;
        margin-top: 2px;
    }

    .content-wrapper-archivos {
        margin-top: 18px;
    }

    .card-soft-archivos {
        background: #ffffff;
        border-radius: 24px;
        padding: 24px 22px 26px;
        box-shadow: 0 20px 45px rgba(15, 23, 42, 0.25);
    }

    .upload-area {
        border: 2px dashed rgba(15, 23, 42, 0.18);
        border-radius: 18px;
        padding: 32px 20px;
        background: #f8fafc;
        text-align: center;
        transition: border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
    }

        .upload-area:hover {
            border-color: var(--c1);
            background: #eff6ff;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.12);
        }

    .upload-icon {
        width: 60px;
        height: 60px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 12px;
        background: rgba(14, 165, 233, 0.15);
    }

        .upload-icon i {
            font-size: 1.8rem;
            color: #0f172a;
        }

    .upload-title {
        font-weight: 600;
        margin-bottom: 4px;
    }

    .upload-subtitle {
        font-size: 0.85rem;
        color: #6b7280;
    }

    #archivoInput {
        margin-top: 14px;
    }

    #preview {
        margin-top: 22px;
        display: none;
    }

    .preview-wrapper {
        background: #f1f5f9;
        border-radius: 18px;
        padding: 16px;
        border: 1px solid #e5e7eb;
    }

    #previewImage,
    #previewPdf {
        max-width: 100%;
        border-radius: 12px;
    }

    .btn-pill {
        border-radius: 999px;
    }

    .btn-danger-soft {
        background: rgba(239, 68, 68, 0.08);
        color: #991b1b;
        border-color: rgba(239, 68, 68, 0.25);
    }

        .btn-danger-soft:hover {
            background: rgba(239, 68, 68, 0.16);
            color: #7f1d1d;
        }
</style>

<div class="page-wrapper-archivos">
    <div class="main-header-archivos d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div>
            <div class="main-title-archivos">
                <i class="fa-solid fa-file-arrow-up"></i>
                Cargar archivo
            </div>
            <div class="main-subtitle-archivos">
                Sube un archivo (imagen o PDF) para almacenarlo en el sistema.
            </div>
        </div>
    </div>

    <div class="content-wrapper-archivos">
        <div class="card-soft-archivos">
            @if (ViewBag.Error != null)
            {
                <div class="alert alert-danger mb-3">
                    <i class="fa-solid fa-circle-exclamation me-1"></i>
                    @ViewBag.Error
                </div>
            }

            @using (Html.BeginForm("NuevoArchivo", "Archivo", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()

                <div class="upload-area">
                    <div class="upload-icon">
                        <i class="fa-regular fa-folder-open"></i>
                    </div>
                    <div class="upload-title">
                        Arrastra y suelta un archivo aquí
                    </div>
                    <div class="upload-subtitle mb-3">
                        O haz clic en el botón para seleccionarlo. Formatos: imagen o PDF.
                    </div>

                    <input type="file"
                           id="archivoInput"
                           name="archivo"
                           class="form-control"
                           accept="image/*,.pdf" />
                </div>

                <div id="preview">
                    <h6 class="mt-3 mb-2 fw-semibold">
                        <i class="fa-solid fa-eye me-1"></i> Vista previa
                    </h6>
                    <div class="preview-wrapper text-center">
                        <img id="previewImage" src="" alt="Vista previa" style="display:none;" />
                        <embed id="previewPdf"
                               src=""
                               type="application/pdf"
                               width="100%"
                               height="450px"
                               style="display:none;" />
                    </div>
                </div>

                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mt-4">
                    <a href="@Url.Action("Index", "Home")"
                       class="btn btn-outline-secondary btn-pill">
                        <i class="fa-solid fa-house me-1"></i> Inicio
                    </a>

                    <div class="d-flex gap-2">
                        <button type="button"
                                id="clearButton"
                                class="btn btn-danger-soft btn-pill">
                            <i class="fa-solid fa-xmark me-1"></i> Limpiar
                        </button>

                        <button type="submit"
                                class="btn btn-primary btn-pill">
                            <i class="fa-solid fa-cloud-arrow-up me-1"></i> Guardar
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<script>
    const archivoInput = document.getElementById('archivoInput');
    const preview = document.getElementById('preview');
    const previewImage = document.getElementById('previewImage');
    const previewPdf = document.getElementById('previewPdf');
    const clearButton = document.getElementById('clearButton');

    if (archivoInput) {
        archivoInput.addEventListener('change', function (event) {
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();

                if (file.type.startsWith('image/')) {
                    reader.onload = function (e) {
                        previewImage.src = e.target.result;
                        previewImage.style.display = 'block';
                        previewPdf.style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                } else if (file.type === 'application/pdf') {
                    reader.onload = function (e) {
                        previewPdf.src = e.target.result;
                        previewPdf.style.display = 'block';
                        previewImage.style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                }

                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
                previewImage.src = '';
                previewPdf.src = '';
            }
        });
    }

    if (clearButton) {
        clearButton.addEventListener('click', function () {
            if (archivoInput) {
                archivoInput.value = '';
            }
            preview.style.display = 'none';
            previewImage.src = '';
            previewImage.style.display = 'none';
            previewPdf.src = '';
            previewPdf.style.display = 'none';
        });
    }
</script>
